<!DOCTYPE html>
<html lang="en" x-data="{ open: false }"> <!-- Alpine.js initialization -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TashFash Dash</title>
    
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script> <!-- Alpine.js added -->
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const calendar = document.querySelector(".calendar");
            const monthYearDisplay = document.querySelector(".month-year");
            const prevButton = document.querySelector(".prev-button");
            const nextButton = document.querySelector(".next-button");
      
            let currentDate = new Date();
      
            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
      
                // Display the current month and year
                const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                monthYearDisplay.textContent = `${monthNames[month]} ${year}`;
      
                // Get the first day of the month
                const firstDay = new Date(year, month, 1).getDay();
                // Get the last day of the month
                const lastDate = new Date(year, month + 1, 0).getDate();
      
                // Clear previous calendar cells
                calendar.innerHTML = "";
      
                // Fill in the blank days before the first day of the month
                for (let i = 0; i < firstDay; i++) {
                    const cell = document.createElement("div");
                    cell.classList.add("calendar-cell", "empty");
                    calendar.appendChild(cell);
                }
      
                // Fill in the days of the month
                for (let date = 1; date <= lastDate; date++) {
                    const cell = document.createElement("div");
                    cell.classList.add("calendar-cell", "filled");
      
                    const topDiv = document.createElement("div");
                    topDiv.classList.add("top");
                    topDiv.innerHTML = `<span class="text-gray-500">${date}</span>`;
      
                    const bottomDiv = document.createElement("div");
                    bottomDiv.classList.add("bottom");
      
                    cell.appendChild(topDiv);
                    cell.appendChild(bottomDiv);
                    calendar.appendChild(cell);
      
                    // Check if there are any appointments for this day
                    fetchAppointments(year, month + 1, date, bottomDiv);
                }
            }
      
            function fetchAppointments(year, month, date, bottomDiv) {
                fetch(`/api/appointments?year=${year}&month=${month}&date=${date}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.appointments && data.appointments.length > 0) {
                            data.appointments.forEach(appointment => {
                                const eventDiv = document.createElement("div");
                                eventDiv.classList.add("event", "bg-blue-400", "text-white", "rounded", "p-1", "text-sm", "mb-1");
                                eventDiv.innerHTML = `
                                    <span class="event-name">${appointment.name}</span>
                                    <span class="time">${appointment.time}</span>
                                `;
                                bottomDiv.appendChild(eventDiv);
                            });
                        }
                    })
                    .catch(error => console.error('Error fetching appointments:', error));
            }
      
            prevButton.addEventListener("click", function () {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });
      
            nextButton.addEventListener("click", function () {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
      
            renderCalendar();
        });
    </script>
    
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <style>
        /* Custom styles for calendar */
        .calendar {
            display: flex;
            flex-wrap: wrap;
        }
        .calendar-cell {
            flex: 1 0 14%; /* Seven columns layout */
            border: 1px solid #e5e7eb;
            height: 120px;
            padding: 0.5rem;
            box-sizing: border-box;
            position: relative;
            transition: background-color 0.2s ease-in-out;
        }
        .calendar-cell.filled:hover {
            background-color: #f3f4f6;
        }
        .calendar-cell .top {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
        }
        .calendar-cell .bottom {
            position: absolute;
            bottom: 0.5rem;
            left: 0.5rem;
            right: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Responsive Layout -->
    <div class="w-screen h-screen flex flex-col md:flex-row">
       <!-- Sidebar -->
       <div class="fixed h-full w-72 shadow-md border-r bg-white hidden md:flex md:flex-col">
        <div class="w-full h-16 flex justify-center items-center">
            <h1 class="text-4xl">TashFash Admin</h1>
        </div>

        <ul class="w-full gap-4 flex flex-col pt-6">
            <li class="w-full h-12 hover:bg-gray-200 pt-2 pl-2"><a href="/dashboard">Dashboard</a></li>
            <li class="w-full h-12 bg-gray-400 pt-2 pl-2"><a href="/schedule">Schedule</a></li>
            <li class="w-full h-12 hover:bg-gray-200 pt-2 pl-2">Notifications</li>
            <li class="w-full h-12 hover:bg-gray-200 pt-2 pl-2"><a href="/picture_collection">Picture Collection</a></li>
            <li>Logout</li>
        </ul>
    </div>

    <!-- Mobile Sidebar with Alpine.js -->
    <div x-show="open" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform -translate-x-full"
         x-transition:enter-end="opacity-100 transform translate-x-0"
         x-transition:leave="transition ease-in duration-300"
         x-transition:leave-start="opacity-100 transform translate-x-0"
         x-transition:leave-end="opacity-0 transform -translate-x-full"
         class="fixed h-full w-64 shadow-md border-r bg-white flex flex-col z-50 md:hidden">
        <ul class="w-full gap-4 flex flex-col pt-6">
            <li><a href="/dashboard">Dashboard</a></li>
            <li><a href="/schedule">Schedule</a></li>
            <li>Notifications</li>
            <li><a href="/picture_collection">Picture Collection</a></li>
            <li>Logout</li>
        </ul>
    </div>

    <!-- Main Content Area -->
    <div class="md:ml-72 h-full w-full flex flex-col">
        <div class="h-full w-full pl-4 pt-4 flex flex-col">
            <div class="flex flex-col md:flex-row h-full w-full">
                <div class="container mx-auto mt-10">
                    <div class="wrapper bg-white rounded shadow w-full">
                        <!-- Calendar Header -->
                        <div class="header flex justify-between border-b p-2">
                            <span class="text-lg font-bold month-year"></span>
                            <div class="buttons">
                                <button class="p-1 prev-button">
                                    <!-- Left Arrow SVG -->
                                    <svg width="1em" fill="gray" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-left-circle">
                                        <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                        <path fill-rule="evenodd" d="M8.354 11.354a.5.5 0 0 0 0-.708L5.707 8l2.647-2.646a.5.5 0 1 0-.708-.708l-3 3a.5.5 0 0 0 0 .708l3 3a.5.5 0 0 0 .708 0z" />
                                        <path fill-rule="evenodd" d="M11.5 8a.5.5 0 0 0-.5-.5H6a.5.5 0 0 0 0 1h5a.5.5 0 0 0 .5-.5z" />
                                    </svg>
                                </button>
                                <button class="p-1 next-button">
                                    <!-- Right Arrow SVG -->
                                    <svg width="1em" fill="gray" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-right-circle">
                                        <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                        <path fill-rule="evenodd" d="M7.646 11.354a.5.5 0 0 1 0-.708L10.293 8 7.646 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0z" />
                                        <path fill-rule="evenodd" d="M4.5 8a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Calendar Grid -->
                        <div class="calendar grid grid-cols-1 md:grid-cols-7 p-2 gap-2 md:gap-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
